<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ron Smithey - Finance</title>
  <!-- CSS Libraries -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.css">
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link rel="stylesheet" href="./assets/css/style.css">
  <style>
    /* Ensure the html and body fill the viewport */
    html, body {
      height: 100%;
      margin: 0;
    }
    /* Wrapper to keep footer at the very bottom */
    #pageWrapper {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    main {
      flex: 1;
    }
    /* Extra styling for the sections */
    .section-padding {
      padding: 60px 0;
    }
    /* Horizontal navigation buttons (Bootstrap pills) */
    .calc-btn-group {
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .calc-btn-group .nav-link {
      display: flex;
      align-items: center;
      gap: 5px;
      background-color: #28a745;
      color: #fff;
      border: 1px solid #28a745;
      padding: 10px 15px;
      border-radius: 5px;
    }
    .calc-btn-group .nav-link:hover {
      background-color: #218838;
      border-color: #1e7e34;
      color: #fff;
    }
    .calc-btn-group .nav-link.active {
      background-color: #218838;
      border-color: #1e7e34;
      color: #fff;
    }
    /* Buttons for calculator forms */
    .btn-calc {
      background-color: #28a745;
      border-color: #28a745;
      color: #fff;
    }
    .btn-calc:hover {
      background-color: #218838;
      border-color: #1e7e34;
      color: #fff;
    }
    .btn-reset {
      background-color: #6c757d;
      border-color: #6c757d;
      color: #fff;
    }
    .btn-reset:hover {
      background-color: #5a6268;
      border-color: #545b62;
      color: #fff;
    }
    /* Calculator Navigation Cards Styling */
    .calc-nav-card {
      background-color: #2c3136;
      border: none;
      border-radius: 16px;
      transition: all 0.3s ease;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      position: relative;
      z-index: 1;
      padding-top: 5px;
      margin-bottom: 10px; /* Extra margin for mobile */
    }
    .calc-nav-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 20%;
      right: 20%;
      height: 5px;
      background: linear-gradient(90deg, rgba(40,167,69,0.1), rgba(40,167,69,0.7), rgba(40,167,69,0.1));
      border-radius: 0 0 5px 5px;
    }
    .calc-nav-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
      opacity: 0;
      z-index: -1;
      transition: opacity 0.3s ease;
    }
    .calc-nav-card:hover {
      transform: translateY(-7px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.15);
    }
    .calc-nav-card:hover::before {
      opacity: 0.1;
    }
    .calc-nav-card.active {
      background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
    }
    .calc-nav-card .icon-wrapper {
      height: 70px;
      width: 70px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(40, 167, 69, 0.1);
      border-radius: 50%;
      color: #28a745;
      font-size: 2rem;
      transition: all 0.3s ease;
    }
    .calc-nav-card:hover .icon-wrapper {
      transform: scale(1.1);
      background-color: rgba(40, 167, 69, 0.15);
    }
    .calc-nav-card.active .icon-wrapper {
      background-color: rgba(255, 255, 255, 0.2);
      color: #fff;
      transform: scale(1.1);
    }
    .calc-nav-card .card-title {
      margin-top: 15px;
      font-weight: 600;
      color: #e2e2e2;
      transition: color 0.3s ease;
    }
    .calc-nav-card:hover .card-title {
      color: #fff;
    }
    .calc-nav-card.active .card-title {
      color: #fff;
    }
    /* Calculator Navigation Cards - Make more responsive */
    @media (max-width: 991.98px) {
      .calc-nav-card .icon-wrapper {
        height: 60px;
        width: 60px;
        font-size: 1.7rem;
      }
      .calc-nav-card .card-title {
        font-size: 0.95rem;
      }
    }
    @media (max-width: 767.98px) {
      .calc-nav-card {
        max-width: 250px;
        margin-left: auto;
        margin-right: auto;
      }
    }
    /* Back-to-Top Button */
    #backToTop {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: none;
      z-index: 1050;
      border: none;
      background-color: #28a745;
      color: #fff;
      padding: 15px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      opacity: 0.9;
    }
    #backToTop i {
      font-size: 1.25rem;
    }
    #backToTop:hover {
      background-color: #218838;
      transform: translateY(-5px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
      opacity: 1;
    }
    /* Budgeting Tools Section Styling */
    #budgetingTools {
      /* Inherit the page's background */
    }
    #budgetingTools .section-header {
      text-align: center;
      margin-bottom: 40px;
    }
    #budgetingTools .card {
      background-color: #343a40; /* Same dark gray as the footer */
      color: #fff;
      border: none;
      border-top: 3px solid #28a745;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    #budgetingTools .card:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    #budgetingTools .card-img-top {
      object-fit: cover;
      height: 200px;
      transition: filter 0.3s ease;
    }
    #budgetingTools .card:hover .card-img-top {
      filter: brightness(0.9);
    }
    #budgetingTools .card-title i {
      font-size: 1.5rem;
      margin-right: 8px;
      vertical-align: middle;
    }
    /* Footer Styling */
    footer {
      background-color: #343a40;
      color: #fff;
      margin: 0;
      padding: 1rem 0;
    }
    .calculator-wrapper {
      max-width: 600px;
      margin: 0 auto;
    }
    
  </style>
</head>
<body data-bs-spy="scroll" data-bs-target=".navbar">
  <div id="pageWrapper">
    <main>
      
      <!-- MAIN NAVBAR (Your original header) -->
      <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
          <a class="navbar-brand" href="homepage.html">
            <img src="./assets/images/Designer.png" alt="Logo" width="100" height="50">
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="mainNavbar">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item"><a class="nav-link" href="homepage.html">Home</a></li>
              <li class="nav-item"><a class="nav-link" href="resources.html">Resources</a></li>
              <li class="nav-item"><a class="nav-link" href="community.html">Community</a></li>
              <li class="nav-item"><a class="nav-link" href="articles.html">Articles</a></li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="legal.html" role="button" data-bs-toggle="dropdown">
                  Legal
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="legal.html">Private Policies</a></li>
                  <li><a class="dropdown-item" href="Compliance.html">Compliance</a></li>
                </ul>
              </li>
              <li class="nav-item"><a class="nav-link" href="contact.html">Contact Us</a></li>
            </ul>
          </div>
        </div>
      </nav>
      
      <!-- CALCULATOR SECTION WITH HORIZONTAL BUTTON NAVIGATION -->
      <section id="calculators" class="section-padding">
        <div class="container">
          <!-- Calculator Section Heading -->
          <div class="text-center mb-4" data-aos="fade-up">
            <h2 class="h4 fw-bold mb-3 text-white">Calculator Options</h2>
            <p class="text-light mb-4">Choose one of the financial tools below to calculate your goals.</p>
          </div>

          <!-- Replacing horizontal navigation with Card Grid Navigation -->
          <div class="row mb-5" id="calcTab" role="tablist">
            <div class="col-md-3 col-sm-6 mb-4" role="presentation">
              <div class="card h-100 text-center calc-nav-card active" id="loan-tab" data-bs-toggle="pill" data-bs-target="#loanCalc" type="button" role="tab" aria-controls="loanCalc" aria-selected="true">
                <div class="card-body py-4 px-3">
                  <div class="icon-wrapper mb-3">
                    <i class="ri-money-dollar-circle-line"></i>
                  </div>
                  <h5 class="card-title mb-0">Loan Calculator</h5>
                </div>
              </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4" role="presentation">
              <div class="card h-100 text-center calc-nav-card" id="retirement-tab" data-bs-toggle="pill" data-bs-target="#retirementCalc" type="button" role="tab" aria-controls="retirementCalc" aria-selected="false">
                <div class="card-body py-4 px-3">
                  <div class="icon-wrapper mb-3">
                    <i class="ri-time-line"></i>
                  </div>
                  <h5 class="card-title mb-0">Retirement Calculator</h5>
                </div>
              </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4" role="presentation">
              <div class="card h-100 text-center calc-nav-card" id="life-tab" data-bs-toggle="pill" data-bs-target="#lifeCalc" type="button" role="tab" aria-controls="lifeCalc" aria-selected="false">
                <div class="card-body py-4 px-3">
                  <div class="icon-wrapper mb-3">
                    <i class="ri-shield-user-line"></i>
                  </div>
                  <h5 class="card-title mb-0">Life Insurance</h5>
                </div>
              </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4" role="presentation">
              <div class="card h-100 text-center calc-nav-card" id="mortgage-tab" data-bs-toggle="pill" data-bs-target="#mortgageCalc" type="button" role="tab" aria-controls="mortgageCalc" aria-selected="false">
                <div class="card-body py-4 px-3">
                  <div class="icon-wrapper mb-3">
                    <i class="ri-home-4-line"></i>
                  </div>
                  <h5 class="card-title mb-0">Mortgage Calculator</h5>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Calculator Forms Content -->
          <div class="tab-content" id="calcTabContent">
            <!-- Loan Payment Calculator -->
            <div class="tab-pane fade show active" id="loanCalc" role="tabpanel" aria-labelledby="loan-tab">
              <div class="text-center mb-4" data-aos="fade-up">
                <h2 class="display-4 fw-semibold">Loan Payment Calculator</h2>
                <p>Estimate your monthly payments, total interest, and the total amount paid.</p>
              </div>
              <form id="loan-calc-form">
                <div class="mb-3">
                  <label for="loan-amount" class="form-label">Loan Amount ($)</label>
                  <input type="number" step="0.001" class="form-control" id="loan-amount" placeholder="Enter loan amount" min="100" max="10000000" required>
                  <div class="invalid-feedback" id="loan-amountFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="loan-interest" class="form-label">Annual Interest Rate (%)</label>
                  <input type="number" step="0.001" class="form-control" id="loan-interest" placeholder="Enter interest rate" min="0" max="50" required>
                  <div class="invalid-feedback" id="loan-interestFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="loan-term" class="form-label">Loan Term</label>
                  <input type="number" step="0.001" class="form-control" id="loan-term" placeholder="Enter loan term" min="1" max="50" required>
                  <select class="form-select mt-2" id="loan-term-type" required>
                    <option value="" disabled selected>Select term type</option>
                    <option value="years">Years</option>
                    <option value="months">Months</option>
                  </select>
                  <div class="invalid-feedback" id="loan-termFeedback"></div>
                </div>
                <button type="submit" class="btn btn-calc w-100">Calculate</button>
                <button type="reset" class="btn btn-reset w-100 mt-3">Reset</button>
              </form>
              <!-- Spinner and Result for Loan Calculator -->
              <div class="spinner-border mt-3" role="status" id="loan-spinner" style="display: none;">
                <span class="visually-hidden">Loading...</span>
              </div>
              <div id="loan-result" class="mt-4 text-center" style="display: none;"></div>
            </div>
            
            <!-- Cost of Retirement Calculator -->
            <div class="tab-pane fade" id="retirementCalc" role="tabpanel" aria-labelledby="retirement-tab">
              <div class="text-center mb-4" data-aos="fade-up">
                <h2 class="display-4 fw-semibold">Cost of Retirement Calculator</h2>
                <p>Estimate the retirement fund you'll need based on your expected expenses at retirement.</p>
              </div>
              <form id="retirement-calc-form">
                <div class="mb-3">
                  <label for="retirement-expense" class="form-label">Current Annual Expense for Retirement ($)</label>
                  <input type="number" step="0.01" class="form-control" id="retirement-expense" placeholder="e.g., 50000" min="1" required>
                  <div class="invalid-feedback" id="retirement-expenseFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="retirement-years" class="form-label">Years Until Retirement</label>
                  <input type="number" step="0.01" class="form-control" id="retirement-years" placeholder="e.g., 20" min="1" required>
                  <div class="invalid-feedback" id="retirement-yearsFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="retirement-inflation" class="form-label">Annual Inflation Rate (%)</label>
                  <input type="number" step="0.01" class="form-control" id="retirement-inflation" placeholder="e.g., 2.5" min="0" required>
                  <div class="invalid-feedback" id="retirement-inflationFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="retirement-withdrawal" class="form-label">Safe Withdrawal Rate (%)</label>
                  <input type="number" step="0.01" class="form-control" id="retirement-withdrawal" placeholder="e.g., 4" min="0" required>
                  <div class="invalid-feedback" id="retirement-withdrawalFeedback"></div>
                </div>
                <button type="submit" class="btn btn-calc w-100">Calculate</button>
                <button type="reset" class="btn btn-reset w-100 mt-3">Reset</button>
              </form>
              <!-- Spinner and Result for Retirement Calculator -->
              <div class="spinner-border mt-3" role="status" id="retirement-spinner" style="display: none;">
                <span class="visually-hidden">Loading...</span>
              </div>
              <div id="retirement-result" class="mt-4 text-center" style="display: none;"></div>
            </div>
            
            <!-- Life Insurance Calculator -->
            <div class="tab-pane fade" id="lifeCalc" role="tabpanel" aria-labelledby="life-tab">
              <div class="text-center mb-4" data-aos="fade-up">
                <h2 class="display-4 fw-semibold">Life Insurance Calculator</h2>
                <p>Estimate how much life insurance coverage you may need.</p>
              </div>
              <form id="life-calc-form">
                <div class="mb-3">
                  <label for="life-income" class="form-label">Annual Income ($)</label>
                  <input type="number" step="0.01" class="form-control" id="life-income" placeholder="Enter annual income" min="1" required>
                  <div class="invalid-feedback" id="life-incomeFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="life-years" class="form-label">Years of Support Needed</label>
                  <input type="number" step="0.01" class="form-control" id="life-years" placeholder="Enter number of years" min="1" required>
                  <div class="invalid-feedback" id="life-yearsFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="life-debts" class="form-label">Outstanding Debts ($)</label>
                  <input type="number" step="0.01" class="form-control" id="life-debts" placeholder="Enter total debts" min="0" required>
                  <div class="invalid-feedback" id="life-debtsFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="life-savings" class="form-label">Current Savings/Assets ($)</label>
                  <input type="number" step="0.01" class="form-control" id="life-savings" placeholder="Enter current savings" min="0" required>
                  <div class="invalid-feedback" id="life-savingsFeedback"></div>
                </div>
                <button type="submit" class="btn btn-calc w-100">Calculate</button>
                <button type="reset" class="btn btn-reset w-100 mt-3">Reset</button>
              </form>
              <!-- Spinner and Result for Life Insurance Calculator -->
              <div class="spinner-border mt-3" role="status" id="life-spinner" style="display: none;">
                <span class="visually-hidden">Loading...</span>
              </div>
              <div id="life-result" class="mt-4 text-center" style="display: none;"></div>
            </div>
            
            <!-- Mortgage Calculator -->
            <div class="tab-pane fade" id="mortgageCalc" role="tabpanel" aria-labelledby="mortgage-tab">
              <div class="text-center mb-4" data-aos="fade-up">
                <h2 class="display-4 fw-semibold">Mortgage Calculator</h2>
                <p>Estimate your monthly mortgage payments and see a breakdown of costs.</p>
              </div>
              <form id="mortgage-calc-form">
                <div class="mb-3">
                  <label for="mortgage-price" class="form-label">Home Price ($)</label>
                  <input type="number" step="0.01" class="form-control" id="mortgage-price" placeholder="Enter home price" min="1000" required>
                  <div class="invalid-feedback" id="mortgage-priceFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="mortgage-down" class="form-label">Down Payment ($)</label>
                  <input type="number" step="0.01" class="form-control" id="mortgage-down" placeholder="Enter down payment amount" min="0" required>
                  <div class="invalid-feedback" id="mortgage-downFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="mortgage-term" class="form-label">Loan Term (years)</label>
                  <select class="form-select" id="mortgage-term" required>
                    <option value="" disabled selected>Select loan term</option>
                    <option value="30">30 years</option>
                    <option value="20">20 years</option>
                    <option value="15">15 years</option>
                    <option value="10">10 years</option>
                  </select>
                  <div class="invalid-feedback" id="mortgage-termFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="mortgage-interest" class="form-label">Interest Rate (%)</label>
                  <input type="number" step="0.001" class="form-control" id="mortgage-interest" placeholder="Enter interest rate" min="0.1" max="25" required>
                  <div class="invalid-feedback" id="mortgage-interestFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="mortgage-tax" class="form-label">Property Tax ($ / year)</label>
                  <input type="number" step="0.01" class="form-control" id="mortgage-tax" placeholder="Enter annual property tax" min="0">
                  <div class="invalid-feedback" id="mortgage-taxFeedback"></div>
                </div>
                <div class="mb-3">
                  <label for="mortgage-insurance" class="form-label">Home Insurance ($ / year)</label>
                  <input type="number" step="0.01" class="form-control" id="mortgage-insurance" placeholder="Enter annual home insurance" min="0">
                  <div class="invalid-feedback" id="mortgage-insuranceFeedback"></div>
                </div>
                <button type="submit" class="btn btn-calc w-100">Calculate</button>
                <button type="reset" class="btn btn-reset w-100 mt-3">Reset</button>
              </form>
              <!-- Spinner and Result for Mortgage Calculator -->
              <div class="spinner-border mt-3" role="status" id="mortgage-spinner" style="display: none;">
                <span class="visually-hidden">Loading...</span>
              </div>
              <div id="mortgage-result" class="mt-4 text-center" style="display: none;"></div>
            </div>
          </div><!-- end tab-content -->
        </div><!-- end container -->
      </section>
      
      <!-- BUDGETING TOOLS SECTION -->
      <section id="budgetingTools" class="section-padding">
        <div class="container">
          <div class="text-center section-header" data-aos="fade-up">
            <h2 class="display-4 fw-semibold">Budgeting Tools</h2>
            <p class="lead">Manage your money effectively with our budgeting tools.</p>
          </div>
          <div class="row">
            <!-- Budget Planner Card -->
            <div class="col-12 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="100">
              <div class="card h-100 border-0 shadow-sm" style="background-color: #343a40; border-top: 3px solid #28a745;">
                <img src="./assets/images/budgetplanner.png" class="card-img-top" alt="Budget Planner" style="height: 220px; object-fit: cover; object-position: center 30%; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div class="card-body">
                  <h5 class="card-title"><i class="ri-calculator-fill"></i> Budget Planner</h5>
                  <p class="card-text">Create a monthly budget and monitor your spending to optimize your savings.</p>
                </div>
                <div class="card-footer bg-transparent text-center">
                  <a href="javascript:void(0);" class="btn btn-calc" id="openBudgetPlanner">Try Budget Planner</a>
                </div>
              </div>
            </div>
            <!-- Expense Tracker Card -->
            <div class="col-12 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="200">
              <div class="card h-100 border-0 shadow-sm" style="background-color: #343a40; border-top: 3px solid #28a745;">
                <img src="./assets/images/expensetracking.jpg" class="card-img-top" alt="Expense Tracker" style="height: 220px; object-fit: cover; object-position: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div class="card-body">
                  <h5 class="card-title"><i class="ri-line-chart-fill"></i> Expense Tracker</h5>
                  <p class="card-text">Track your daily expenses and analyze your spending to improve your finances.</p>
                </div>
                <div class="card-footer bg-transparent text-center">
                  <a href="javascript:void(0);" class="btn btn-calc" id="openExpenseTracker">Try Expense Tracker</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- FOOTER -->
      <footer class="text-center py-4">
        <div class="container">
          <p>&copy; 2025 Ron Smithey. All Rights Reserved.</p>
        </div>
      </footer>
    </main>
  </div> <!-- End #pageWrapper -->
  
  <!-- Fixed Back to Top Button (direct HTML approach) -->
  <button id="backToTopFixed" title="Back to Top" style="position: fixed; bottom: 30px; right: 30px; z-index: 99999; width: 50px; height: 50px; border-radius: 50%; background-color: #28a745; color: #fff; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: all 0.3s ease;">
    <i class="ri-arrow-up-line" style="font-size: 1.25rem;"></i>
  </button>
  
  <!-- Coming Soon Modal -->
  <div class="modal fade" id="comingSoonModal" tabindex="-1" aria-labelledby="comingSoonModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="comingSoonModalLabel">Feature Coming Soon</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center py-4">
          <i class="ri-time-line" style="font-size: 3rem; color: #28a745;"></i>
          <h4 class="my-3">We're Working On It!</h4>
          <p>This feature is currently under development and will be available soon. Please check back later!</p>
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button type="button" class="btn btn-calc" data-bs-dismiss="modal">Got it</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- BUDGET PLANNER MODAL -->
  <div class="modal fade" id="budgetPlannerModal" tabindex="-1" aria-labelledby="budgetPlannerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="budgetPlannerModalLabel">Budget Planner</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Instructions Panel -->
          <div class="alert bg-dark border border-secondary text-light mb-4" role="alert">
            <h6 class="alert-heading text-success"><i class="ri-information-line me-2"></i>How to Use This Budget Planner</h6>
            <ol class="mb-0 small">
              <li>Enter your income sources and amounts in the <strong>Income</strong> section</li>
              <li>Enter your expenses by category in the <strong>Expenses</strong> section</li>
              <li>Use the dropdown to switch between expense categories</li>
              <li>The summary will update automatically or click <strong>Calculate</strong></li>
              <li>Click <strong>Save Budget</strong> to store your budget for future sessions</li>
            </ol>
          </div>
          
          <!-- Budget Planner Interface -->
          <div class="row">
            <!-- Left Side: Income & Expenses Forms -->
            <div class="col-md-6">
              <!-- Income Section -->
              <div class="card bg-dark border-secondary mb-4">
                <div class="card-header bg-success bg-opacity-25 text-white">
                  <h5 class="mb-0"><i class="ri-money-dollar-circle-line me-2"></i>Income</h5>
                </div>
                <div class="card-body">
                  <form id="incomeForm">
                    <div class="mb-3">
                      <label class="form-label">Enter Your Income Sources</label>
                      <div class="income-item">
                        <div class="input-group mb-2">
                          <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-money-dollar-circle-line"></i></span>
                          <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Income Source (e.g., Salary)" required>
                          <input type="number" class="form-control income-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01" required>
                          <button type="button" class="btn btn-outline-danger delete-income" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                        </div>
                      </div>
                    </div>
                    <button type="button" id="addIncomeBtn" class="btn btn-outline-success w-100">
                      <i class="ri-add-line me-2"></i>Add Another Income Source
                    </button>
                    <div class="small text-muted mt-2">Enter all regular income sources (salary, side gigs, rental income, etc.)</div>
                  </form>
                </div>
              </div>
              
              <!-- Expenses Section -->
              <div class="card bg-dark border-secondary">
                <div class="card-header bg-success bg-opacity-25 text-white">
                  <h5 class="mb-0"><i class="ri-shopping-cart-line me-2"></i>Expenses</h5>
                </div>
                <div class="card-body">
                  <form id="expensesForm">
                    <!-- Expense Categories -->
                    <div class="mb-3">
                      <label class="form-label">Step 1: Select an Expense Category</label>
                      <select id="expenseCategory" class="form-select bg-dark border-secondary text-light">
                        <option value="housing">üè† Housing</option>
                        <option value="transportation">üöó Transportation</option>
                        <option value="food">üçî Food & Groceries</option>
                        <option value="utilities">üí° Utilities</option>
                        <option value="healthcare">üè• Healthcare</option>
                        <option value="entertainment">üé¨ Entertainment</option>
                        <option value="debt">üí≥ Debt Payments</option>
                        <option value="savings">üí∞ Savings</option>
                        <option value="other">üì¶ Other</option>
                      </select>
                      <div class="small text-muted mt-1">After entering expenses in one category, select another to continue.</div>
                    </div>
                    
                    <div class="mt-2 mb-3">
                      <label class="form-label">Step 2: Enter Expenses in This Category</label>
                    </div>
                    
                    <!-- Housing Expenses -->
                    <div class="expense-category-group" id="housing-expenses">
                      <div class="card bg-dark border-secondary mb-3">
                        <div class="card-header bg-dark">
                          <h6 class="mb-0 text-white-50">üè† Housing Expenses</h6>
                        </div>
                        <div class="card-body py-3">
                          <div class="expense-item mb-2">
                            <div class="input-group">
                              <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-home-4-line"></i></span>
                              <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Rent/Mortgage" value="Rent/Mortgage" readonly>
                              <input type="number" class="form-control expense-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01">
                              <button type="button" class="btn btn-outline-danger delete-expense" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                            </div>
                          </div>
                          <div class="expense-item mb-2">
                            <div class="input-group">
                              <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-government-line"></i></span>
                              <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Property Taxes" value="Property Taxes" readonly>
                              <input type="number" class="form-control expense-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01">
                              <button type="button" class="btn btn-outline-danger delete-expense" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                            </div>
                          </div>
                          <button type="button" class="btn btn-outline-secondary btn-sm add-expense mt-2" data-category="housing">
                            <i class="ri-add-line me-2"></i>Add Housing Expense
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Transportation Expenses -->
                    <div class="expense-category-group" id="transportation-expenses" style="display:none;">
                      <div class="card bg-dark border-secondary mb-3">
                        <div class="card-header bg-dark">
                          <h6 class="mb-0 text-white-50">üöó Transportation Expenses</h6>
                        </div>
                        <div class="card-body py-3">
                          <div class="expense-item mb-2">
                            <div class="input-group">
                              <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-car-line"></i></span>
                              <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Car Payment" value="Car Payment" readonly>
                              <input type="number" class="form-control expense-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01">
                              <button type="button" class="btn btn-outline-danger delete-expense" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                            </div>
                          </div>
                          <div class="expense-item mb-2">
                            <div class="input-group">
                              <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-gas-station-line"></i></span>
                              <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Gas/Fuel" value="Gas/Fuel" readonly>
                              <input type="number" class="form-control expense-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01">
                              <button type="button" class="btn btn-outline-danger delete-expense" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                            </div>
                          </div>
                          <button type="button" class="btn btn-outline-secondary btn-sm add-expense mt-2" data-category="transportation">
                            <i class="ri-add-line me-2"></i>Add Transportation Expense
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Food Expenses -->
                    <div class="expense-category-group" id="food-expenses" style="display:none;">
                      <div class="card bg-dark border-secondary mb-3">
                        <div class="card-header bg-dark">
                          <h6 class="mb-0 text-white-50">üçî Food & Groceries Expenses</h6>
                        </div>
                        <div class="card-body py-3">
                          <div class="expense-item mb-2">
                            <div class="input-group">
                              <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-shopping-basket-line"></i></span>
                              <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Groceries" value="Groceries" readonly>
                              <input type="number" class="form-control expense-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01">
                              <button type="button" class="btn btn-outline-danger delete-expense" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                            </div>
                          </div>
                          <div class="expense-item mb-2">
                            <div class="input-group">
                              <span class="input-group-text bg-dark border-secondary text-success"><i class="ri-restaurant-line"></i></span>
                              <input type="text" class="form-control bg-dark border-secondary text-light" placeholder="Dining Out" value="Dining Out" readonly>
                              <input type="number" class="form-control expense-amount bg-dark border-secondary text-light" placeholder="Amount" min="0" step="0.01">
                              <button type="button" class="btn btn-outline-danger delete-expense" style="display:none;"><i class="ri-delete-bin-line"></i></button>
                            </div>
                          </div>
                          <button type="button" class="btn btn-outline-secondary btn-sm add-expense mt-2" data-category="food">
                            <i class="ri-add-line me-2"></i>Add Food Expense
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Add remaining expense categories in the same pattern... -->
                    <!-- For brevity, I'm including just a few categories, but would add all nine categories in the final implementation -->
                  </form>
                </div>
              </div>
            </div>
            
            <!-- Right Side: Budget Summary & Chart -->
            <div class="col-md-6">
              <div class="card bg-dark border-secondary mb-4">
                <div class="card-header bg-success bg-opacity-25 text-white">
                  <h5 class="mb-0"><i class="ri-pie-chart-line me-2"></i>Budget Summary</h5>
                </div>
                <div class="card-body">
                  <div class="alert bg-dark text-light border border-secondary mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h6 class="mb-0">Total Monthly Income:</h6>
                      <span id="totalIncome" class="text-success fs-5">$0.00</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h6 class="mb-0">Total Monthly Expenses:</h6>
                      <span id="totalExpenses" class="text-danger fs-5">$0.00</span>
                    </div>
                    <hr class="border-secondary">
                    <div class="d-flex justify-content-between align-items-center">
                      <h6 class="mb-0 fw-bold">Your Monthly Balance:</h6>
                      <span id="budgetBalance" class="fw-bold fs-4">$0.00</span>
                    </div>
                    <div class="text-center mt-3">
                      <span class="badge bg-success">Click "Calculate" anytime to update</span>
                    </div>
                  </div>
                  
                  <!-- Budget Chart -->
                  <div class="mt-4">
                    <h6 class="text-white-50 mb-3">Your Expense Breakdown</h6>
                    <div class="chart-container" style="position: relative; height: 250px;">
                      <canvas id="budgetChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Budget Tips Card -->
              <div class="card bg-dark border-secondary">
                <div class="card-header bg-success bg-opacity-25 text-white">
                  <h5 class="mb-0"><i class="ri-lightbulb-line me-2"></i>Budget Tips</h5>
                </div>
                <div class="card-body">
                  <div id="budgetTips">
                    <div class="tip-card p-3 mb-2 rounded bg-dark border border-secondary">
                      <p class="mb-0 small"><i class="ri-information-line me-2 text-success"></i>The 50/30/20 rule suggests spending 50% on needs, 30% on wants, and 20% on savings.</p>
                    </div>
                    <div class="tip-card p-3 mb-2 rounded bg-dark border border-secondary">
                      <p class="mb-0 small"><i class="ri-information-line me-2 text-success"></i>Try to keep housing costs below 30% of your monthly income.</p>
                    </div>
                    <div class="tip-card p-3 rounded bg-dark border border-secondary">
                      <p class="mb-0 small"><i class="ri-information-line me-2 text-success"></i>Save at least 3-6 months of expenses in an emergency fund.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
          <button type="button" id="calculateBudgetBtn" class="btn btn-calc">Calculate</button>
          <button type="button" id="saveBudgetBtn" class="btn btn-calc">Save Budget</button>
          <button type="button" id="printBudgetBtn" class="btn btn-outline-secondary">Print</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Expense Tracker Modal -->
  <div class="modal fade" id="expenseTrackerModal" tabindex="-1" aria-labelledby="expenseTrackerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="expenseTrackerModalLabel">Expense Tracker</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Instructions Panel -->
          <div class="alert bg-dark border border-secondary text-light mb-4" role="alert">
            <h6 class="alert-heading text-success"><i class="ri-information-line me-2"></i>How to Use This Expense Tracker</h6>
            <ol class="mb-0 small">
              <li>Add your expenses using the <strong>Add Expense</strong> form</li>
              <li>View and filter your expenses in the <strong>Expense History</strong> section</li>
              <li>Track your spending patterns with the <strong>Expense Summary</strong> visuals</li>
              <li>Edit or delete expenses using the action buttons in the list</li>
              <li>Your expenses are saved automatically for future sessions</li>
            </ol>
          </div>
          
          <!-- Expense Tracker Interface -->
          <div class="row">
            <!-- Left Side: Add Expense Form & Filters -->
            <div class="col-md-5">
              <!-- Add Expense Section -->
              <div class="card bg-dark border-secondary mb-4">
                <div class="card-header bg-success bg-opacity-25 text-white">
                  <h5 class="mb-0"><i class="ri-add-circle-line me-2"></i>Add Expense</h5>
                </div>
                <div class="card-body">
                  <form id="addExpenseForm">
                    <div class="mb-3">
                      <label for="expenseDescription" class="form-label">Description</label>
                      <input type="text" class="form-control bg-dark border-secondary text-light" id="expenseDescription" placeholder="What did you spend on?" required>
                    </div>
                    <div class="mb-3">
                      <label for="expenseAmount" class="form-label">Amount ($)</label>
                      <input type="number" class="form-control bg-dark border-secondary text-light" id="expenseAmount" placeholder="How much did you spend?" step="0.01" min="0.01" required>
                    </div>
                    <div class="mb-3">
                      <label for="expenseCategory" class="form-label">Category</label>
                      <select class="form-select bg-dark border-secondary text-light" id="expenseCategory" required>
                        <option value="" disabled selected>Select a category</option>
                        <option value="food">üçî Food & Dining</option>
                        <option value="transportation">üöó Transportation</option>
                        <option value="entertainment">üé¨ Entertainment</option>
                        <option value="shopping">üõçÔ∏è Shopping</option>
                        <option value="utilities">üí° Utilities</option>
                        <option value="housing">üè† Housing</option>
                        <option value="healthcare">üè• Healthcare</option>
                        <option value="education">üìö Education</option>
                        <option value="personal">üë§ Personal</option>
                        <option value="other">üì¶ Other</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="expenseDate" class="form-label">Date</label>
                      <input type="date" class="form-control bg-dark border-secondary text-light" id="expenseDate" required>
                    </div>
                    <div class="mb-3">
                      <label for="expenseNotes" class="form-label">Notes (Optional)</label>
                      <textarea class="form-control bg-dark border-secondary text-light" id="expenseNotes" rows="2" placeholder="Any additional details..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-calc w-100">Add Expense</button>
                  </form>
                </div>
              </div>
              
              <!-- Filter Section -->
              <div class="card bg-dark border-secondary">
                <div class="card-header bg-dark">
                  <h5 class="mb-0 text-white-50"><i class="ri-filter-3-line me-2"></i>Filter Expenses</h5>
                </div>
                <div class="card-body">
                  <form id="filterExpensesForm">
                    <div class="mb-3">
                      <label for="filterDateRange" class="form-label">Date Range</label>
                      <select class="form-select bg-dark border-secondary text-light" id="filterDateRange">
                        <option value="all">All Time</option>
                        <option value="today" selected>Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                      </select>
                    </div>
                    <div id="customDateRange" style="display: none;">
                      <div class="row g-2 mb-3">
                        <div class="col-6">
                          <label for="filterStartDate" class="form-label">Start Date</label>
                          <input type="date" class="form-control bg-dark border-secondary text-light" id="filterStartDate">
                        </div>
                        <div class="col-6">
                          <label for="filterEndDate" class="form-label">End Date</label>
                          <input type="date" class="form-control bg-dark border-secondary text-light" id="filterEndDate">
                        </div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="filterCategory" class="form-label">Category</label>
                      <select class="form-select bg-dark border-secondary text-light" id="filterCategory">
                        <option value="all" selected>All Categories</option>
                        <option value="food">üçî Food & Dining</option>
                        <option value="transportation">üöó Transportation</option>
                        <option value="entertainment">üé¨ Entertainment</option>
                        <option value="shopping">üõçÔ∏è Shopping</option>
                        <option value="utilities">üí° Utilities</option>
                        <option value="housing">üè† Housing</option>
                        <option value="healthcare">üè• Healthcare</option>
                        <option value="education">üìö Education</option>
                        <option value="personal">üë§ Personal</option>
                        <option value="other">üì¶ Other</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="filterMinAmount" class="form-label">Amount Range ($)</label>
                      <div class="row g-2">
                        <div class="col-6">
                          <input type="number" class="form-control bg-dark border-secondary text-light" id="filterMinAmount" placeholder="Min" min="0">
                        </div>
                        <div class="col-6">
                          <input type="number" class="form-control bg-dark border-secondary text-light" id="filterMaxAmount" placeholder="Max" min="0">
                        </div>
                      </div>
                    </div>
                    <button type="submit" class="btn btn-outline-secondary w-100">Apply Filters</button>
                  </form>
                </div>
              </div>
            </div>
            
            <!-- Right Side: Expense List & Summary -->
            <div class="col-md-7">
              <!-- Summary Section -->
              <div class="card bg-dark border-secondary mb-4">
                <div class="card-header bg-success bg-opacity-25 text-white">
                  <h5 class="mb-0"><i class="ri-pie-chart-line me-2"></i>Expense Summary</h5>
                </div>
                <div class="card-body">
                  <div class="alert bg-dark text-light border border-secondary mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h6 class="mb-0">Total Expenses (Period):</h6>
                      <span id="totalPeriodExpenses" class="text-danger fs-5">$0.00</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <h6 class="mb-0">Average Daily Spending:</h6>
                      <span id="averageDailyExpenses" class="text-warning fs-5">$0.00</span>
                    </div>
                  </div>
                  
                  <!-- Expense Chart -->
                  <div class="mb-3">
                    <h6 class="text-white-50 mb-2">Spending by Category</h6>
                    <div class="chart-container" style="position: relative; height: 200px;">
                      <canvas id="expenseCategoryChart"></canvas>
                    </div>
                  </div>
                  
                  <!-- Expense Trend -->
                  <div>
                    <h6 class="text-white-50 mb-2">Spending Trend</h6>
                    <div class="chart-container" style="position: relative; height: 150px;">
                      <canvas id="expenseTrendChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Expense List Section -->
              <div class="card bg-dark border-secondary">
                <div class="card-header bg-success bg-opacity-25 text-white d-flex justify-content-between align-items-center">
                  <h5 class="mb-0"><i class="ri-list-check me-2"></i>Expense History</h5>
                  <span id="expenseCount" class="badge bg-success">0 expenses</span>
                </div>
                <div class="card-body p-0">
                  <div class="list-group list-group-flush" id="expenseList">
                    <!-- Expenses will be dynamically populated here -->
                    <div class="text-center p-4 text-muted">
                      <i class="ri-inbox-line d-block mb-3" style="font-size: 2rem;"></i>
                      <p>No expenses to show. Add your first expense to get started!</p>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-dark border-secondary">
                  <div class="d-flex justify-content-between align-items-center">
                    <button id="clearAllExpenses" class="btn btn-outline-danger btn-sm">
                      <i class="ri-delete-bin-line me-1"></i>Clear All
                    </button>
                    <button id="exportExpenseData" class="btn btn-outline-success btn-sm">
                      <i class="ri-download-line me-1"></i>Export Data
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
          <button type="button" id="printExpenseReport" class="btn btn-outline-secondary">Print Report</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./assets/js/main.js"></script>
  
  <!-- Calculator JavaScript -->
  <script>
    // Utility: Simple validation for numeric input (up to 3 decimals by default)
    function validateInput(id, rawValue, min, max) {
      const numericValue = parseFloat(rawValue);
      const regex = /^\d*(\.\d{0,3})?$/;
      if (isNaN(numericValue) || numericValue < min || numericValue > max || /[eE]/.test(rawValue) || !regex.test(rawValue)) {
        document.getElementById(id).classList.add('is-invalid');
        return false;
      } else {
        document.getElementById(id).classList.remove('is-invalid');
        return true;
      }
    }
    
    // Format as US Currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
    }
    
    // Prevent scientific notation (optional)
    function preventScientificNotation(event) {
      const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Enter'];
      if (allowedKeys.includes(event.key)) return;
      if (/[eE]/.test(event.key)) event.preventDefault();
    }
    
    // -------------------------
    // Loan Payment Calculator
    // -------------------------
    document.getElementById('loan-amount').addEventListener('input', preventScientificNotation);
    document.getElementById('loan-interest').addEventListener('input', preventScientificNotation);
    document.getElementById('loan-term').addEventListener('input', preventScientificNotation);
    
    document.getElementById('loan-calc-form').addEventListener('submit', function(event) {
      event.preventDefault();
      let valid = true;
      valid &= validateInput('loan-amount', document.getElementById('loan-amount').value, 100, 10000000);
      valid &= validateInput('loan-interest', document.getElementById('loan-interest').value, 0, 50);
      valid &= validateInput('loan-term', document.getElementById('loan-term').value, 1, 50);
      if (document.getElementById('loan-term-type').value === "") {
        alert("Please select a term type.");
        valid = false;
      }
      if (!valid) return;
      
      const principal = parseFloat(document.getElementById('loan-amount').value);
      const interestRate = parseFloat(document.getElementById('loan-interest').value);
      const term = parseFloat(document.getElementById('loan-term').value);
      const termType = document.getElementById('loan-term-type').value;
      const numberOfPayments = (termType === "years") ? term * 12 : term;
      
      document.getElementById('loan-spinner').style.display = 'inline-block';
      let monthlyPayment;
      if (interestRate === 0) {
        monthlyPayment = principal / numberOfPayments;
      } else {
        const monthlyRate = (interestRate / 100) / 12;
        monthlyPayment = (principal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -numberOfPayments));
      }
      const totalPaid = monthlyPayment * numberOfPayments;
      const totalInterest = totalPaid - principal;
      document.getElementById('loan-spinner').style.display = 'none';
      document.getElementById('loan-result').innerHTML = `
        <h4>Estimated Monthly Payment: <span>${formatCurrency(monthlyPayment)}</span></h4>
        <p>Total Interest Paid: <span>${formatCurrency(totalInterest)}</span></p>
        <p>Total Amount Paid: <span>${formatCurrency(totalPaid)}</span></p>
      `;
      document.getElementById('loan-result').style.display = 'block';
    });
    
    document.getElementById('loan-calc-form').addEventListener('reset', function() {
      document.getElementById('loan-result').style.display = 'none';
    });
    
    // -------------------------------
    // Cost of Retirement Calculator
    // -------------------------------
    document.getElementById('retirement-expense').addEventListener('input', preventScientificNotation);
    document.getElementById('retirement-years').addEventListener('input', preventScientificNotation);
    document.getElementById('retirement-inflation').addEventListener('input', preventScientificNotation);
    document.getElementById('retirement-withdrawal').addEventListener('input', preventScientificNotation);
    
    document.getElementById('retirement-calc-form').addEventListener('submit', function(event) {
      event.preventDefault();
      let valid = true;
      valid &= validateInput('retirement-expense', document.getElementById('retirement-expense').value, 1, 1000000000);
      valid &= validateInput('retirement-years', document.getElementById('retirement-years').value, 1, 100);
      valid &= validateInput('retirement-inflation', document.getElementById('retirement-inflation').value, 0, 100);
      valid &= validateInput('retirement-withdrawal', document.getElementById('retirement-withdrawal').value, 0.1, 100);
      if (!valid) return;
      
      const expense = parseFloat(document.getElementById('retirement-expense').value);
      const years = parseFloat(document.getElementById('retirement-years').value);
      const inflation = parseFloat(document.getElementById('retirement-inflation').value);
      const withdrawal = parseFloat(document.getElementById('retirement-withdrawal').value);
      
      document.getElementById('retirement-spinner').style.display = 'inline-block';
      const futureExpense = expense * Math.pow((1 + inflation/100), years);
      const requiredNestEgg = futureExpense / (withdrawal/100);
      document.getElementById('retirement-spinner').style.display = 'none';
      document.getElementById('retirement-result').innerHTML = `
        <h4>Future Annual Expense at Retirement: <span>${formatCurrency(futureExpense)}</span></h4>
        <p>Estimated Required Nest Egg (using a ${withdrawal}% withdrawal rate): <span>${formatCurrency(requiredNestEgg)}</span></p>
      `;
      document.getElementById('retirement-result').style.display = 'block';
    });
    
    document.getElementById('retirement-calc-form').addEventListener('reset', function() {
      document.getElementById('retirement-result').style.display = 'none';
    });
    
    // -----------------------------
    // Life Insurance Calculator
    // -----------------------------
    document.getElementById('life-income').addEventListener('input', preventScientificNotation);
    document.getElementById('life-years').addEventListener('input', preventScientificNotation);
    document.getElementById('life-debts').addEventListener('input', preventScientificNotation);
    document.getElementById('life-savings').addEventListener('input', preventScientificNotation);
    
    document.getElementById('life-calc-form').addEventListener('submit', function(event) {
      event.preventDefault();
      let valid = true;
      valid &= validateInput('life-income', document.getElementById('life-income').value, 1, 1000000000);
      valid &= validateInput('life-years', document.getElementById('life-years').value, 1, 100);
      valid &= validateInput('life-debts', document.getElementById('life-debts').value, 0, 1000000000);
      valid &= validateInput('life-savings', document.getElementById('life-savings').value, 0, 1000000000);
      if (!valid) return;
      
      const income = parseFloat(document.getElementById('life-income').value);
      const years = parseFloat(document.getElementById('life-years').value);
      const debts = parseFloat(document.getElementById('life-debts').value);
      const savings = parseFloat(document.getElementById('life-savings').value);
      
      document.getElementById('life-spinner').style.display = 'inline-block';
      let recommendedCoverage = (income * years) + debts - savings;
      if (recommendedCoverage < 0) {
        recommendedCoverage = 0;
      }
      document.getElementById('life-spinner').style.display = 'none';
      document.getElementById('life-result').innerHTML = `
        <h4>Recommended Life Insurance Coverage: <span>${formatCurrency(recommendedCoverage)}</span></h4>
      `;
      document.getElementById('life-result').style.display = 'block';
    });
    
    document.getElementById('life-calc-form').addEventListener('reset', function() {
      document.getElementById('life-result').style.display = 'none';
    });
    
    // -----------------------------
    // Mortgage Calculator
    // -----------------------------
    document.getElementById('mortgage-price').addEventListener('input', preventScientificNotation);
    document.getElementById('mortgage-down').addEventListener('input', preventScientificNotation);
    document.getElementById('mortgage-interest').addEventListener('input', preventScientificNotation);
    document.getElementById('mortgage-tax').addEventListener('input', preventScientificNotation);
    document.getElementById('mortgage-insurance').addEventListener('input', preventScientificNotation);
    
    document.getElementById('mortgage-calc-form').addEventListener('submit', function(event) {
      event.preventDefault();
      let valid = true;
      valid &= validateInput('mortgage-price', document.getElementById('mortgage-price').value, 1000, 100000000);
      valid &= validateInput('mortgage-down', document.getElementById('mortgage-down').value, 0, 100000000);
      valid &= validateInput('mortgage-interest', document.getElementById('mortgage-interest').value, 0.1, 25);
      
      // Optional fields can be 0 or more
      const taxValue = document.getElementById('mortgage-tax').value;
      if (taxValue !== '') {
        valid &= validateInput('mortgage-tax', taxValue, 0, 1000000);
      }
      
      const insuranceValue = document.getElementById('mortgage-insurance').value;
      if (insuranceValue !== '') {
        valid &= validateInput('mortgage-insurance', insuranceValue, 0, 100000);
      }
      
      if (document.getElementById('mortgage-term').value === "") {
        alert("Please select a loan term.");
        valid = false;
      }
      
      if (!valid) return;
      
      const homePrice = parseFloat(document.getElementById('mortgage-price').value);
      const downPayment = parseFloat(document.getElementById('mortgage-down').value);
      const loanTerm = parseInt(document.getElementById('mortgage-term').value);
      const interestRate = parseFloat(document.getElementById('mortgage-interest').value);
      const propertyTax = taxValue !== '' ? parseFloat(taxValue) : 0;
      const homeInsurance = insuranceValue !== '' ? parseFloat(insuranceValue) : 0;
      
      document.getElementById('mortgage-spinner').style.display = 'inline-block';
      
      // Calculate loan amount
      const loanAmount = homePrice - downPayment;
      
      // Calculate monthly mortgage payment (Principal + Interest)
      const monthlyRate = (interestRate / 100) / 12;
      const numberOfPayments = loanTerm * 12;
      let monthlyPayment = 0;
      
      if (interestRate === 0) {
        monthlyPayment = loanAmount / numberOfPayments;
      } else {
        monthlyPayment = (loanAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -numberOfPayments));
      }
      
      // Calculate monthly property tax and insurance
      const monthlyTax = propertyTax / 12;
      const monthlyInsurance = homeInsurance / 12;
      
      // Calculate total monthly payment including tax and insurance
      const totalMonthlyPayment = monthlyPayment + monthlyTax + monthlyInsurance;
      
      // Calculate total interest paid over the life of the loan
      const totalInterest = (monthlyPayment * numberOfPayments) - loanAmount;
      
      document.getElementById('mortgage-spinner').style.display = 'none';
      
      // Display results
      document.getElementById('mortgage-result').innerHTML = `
        <h4>Estimated Monthly Payment: <span>${formatCurrency(totalMonthlyPayment)}</span></h4>
        <div class="row mt-3">
          <div class="col-md-6">
            <p><strong>Principal & Interest:</strong> ${formatCurrency(monthlyPayment)}</p>
            <p><strong>Loan Amount:</strong> ${formatCurrency(loanAmount)}</p>
            <p><strong>Down Payment:</strong> ${formatCurrency(downPayment)}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Property Tax:</strong> ${formatCurrency(monthlyTax)}/month</p>
            <p><strong>Home Insurance:</strong> ${formatCurrency(monthlyInsurance)}/month</p>
            <p><strong>Total Interest Paid:</strong> ${formatCurrency(totalInterest)}</p>
          </div>
        </div>
      `;
      document.getElementById('mortgage-result').style.display = 'block';
    });
    
    document.getElementById('mortgage-calc-form').addEventListener('reset', function() {
      document.getElementById('mortgage-result').style.display = 'none';
    });
    
    // Initialize AOS for animations (if needed)
    AOS.init();
  </script>
  
  <!-- Expense Tracker JavaScript -->
  <script>
    // Handle expense tracker button click
    document.addEventListener('DOMContentLoaded', function() {
      // Handle expense tracker button
      const expenseTrackerBtn = document.getElementById('openExpenseTracker');
      if (expenseTrackerBtn) {
        expenseTrackerBtn.addEventListener('click', function(e) {
          e.preventDefault();
          const expenseTrackerModal = document.getElementById('expenseTrackerModal');
          if (expenseTrackerModal) {
            const modal = new bootstrap.Modal(expenseTrackerModal);
            
            // Set up one-time initialization
            if (!window.expenseTrackerInitialized) {
              expenseTrackerModal.addEventListener('shown.bs.modal', function() {
                initExpenseTracker();
              }, { once: true }); // Only run once
              window.expenseTrackerInitialized = true;
            }
            
            modal.show();
          }
        });
      }
      
      // Handle back to top button
      const backToTopBtn = document.getElementById('backToTopFixed');
      if (backToTopBtn) {
        backToTopBtn.addEventListener('click', function() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }
      
      // Handle budget planner button
      const budgetPlannerBtn = document.getElementById('openBudgetPlanner');
      if (budgetPlannerBtn) {
        budgetPlannerBtn.addEventListener('click', function(e) {
          e.preventDefault();
          const budgetPlannerModal = document.getElementById('budgetPlannerModal');
          if (budgetPlannerModal) {
            const modal = new bootstrap.Modal(budgetPlannerModal);
            
            // Set up one-time initialization
            if (!window.budgetPlannerInitialized) {
              budgetPlannerModal.addEventListener('shown.bs.modal', function() {
                initBudgetPlanner();
              }, { once: true }); // Only run once
              window.budgetPlannerInitialized = true;
            }
            
            modal.show();
          }
        });
      }
    });
    
    // Expense Tracker functionality
    function initExpenseTracker() {
      console.log("Initializing expense tracker");
      
      // ----- DOM Elements -----
      const addExpenseForm = document.getElementById('addExpenseForm');
      const filterExpensesForm = document.getElementById('filterExpensesForm');
      const filterDateRange = document.getElementById('filterDateRange');
      const customDateRange = document.getElementById('customDateRange');
      const expenseList = document.getElementById('expenseList');
      const clearAllExpenses = document.getElementById('clearAllExpenses');
      const exportExpenseData = document.getElementById('exportExpenseData');
      const printExpenseReport = document.getElementById('printExpenseReport');
      const expenseCount = document.getElementById('expenseCount');
      
      // Verify all required elements exist
      if (!addExpenseForm || !filterExpensesForm || !expenseList) {
        console.error("Critical expense tracker elements missing");
        return;
      }
      
      // Chart elements
      const categoryChartCanvas = document.getElementById('expenseCategoryChart');
      const trendChartCanvas = document.getElementById('expenseTrendChart');
      
      // ----- State Variables -----
      let expenses = [];
      let filteredExpenses = [];
      let categoryChart = null;
      let trendChart = null;
      let isInEditMode = false;
      let currentEditId = null;
      
      // ----- Utility Functions -----
      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', { 
          style: 'currency', 
          currency: 'USD' 
        }).format(amount);
      }
      
      function getCategoryEmoji(category) {
        const emojiMap = {
          food: 'üçî',
          transportation: 'üöó',
          entertainment: 'üé¨',
          shopping: 'üõçÔ∏è',
          utilities: 'üí°',
          housing: 'üè†',
          healthcare: 'üè•',
          education: 'üìö',
          personal: 'üë§',
          other: 'üì¶'
        };
        return emojiMap[category] || 'üìã';
      }
      
      function formatDate(dateString) {
        const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
      }
      
      // ----- Initialization -----
      function init() {
        // Set default date to today
        document.getElementById('expenseDate').valueAsDate = new Date();
        
        // Set default filter to "all time"
        if (filterDateRange) {
          filterDateRange.value = 'all';
        }
        
        // Load saved expenses from localStorage
        loadExpenses();
        
        // Initialize charts
        initCharts();
        
        // Attach event handlers
        setupEventHandlers();
      }
      
      // ----- Event Handlers -----
      function setupEventHandlers() {
        // Form submission handlers
        if (addExpenseForm) {
          addExpenseForm.addEventListener('submit', handleAddExpense);
        }
        
        if (filterExpensesForm) {
          filterExpensesForm.addEventListener('submit', function(e) {
            e.preventDefault();
            applyFilters();
          });
        }
        
        // Filter date range change
        if (filterDateRange && customDateRange) {
          filterDateRange.addEventListener('change', function() {
            customDateRange.style.display = this.value === 'custom' ? 'block' : 'none';
            if (this.value !== 'custom') {
              applyFilters();
            }
          });
        }
        
        // Clear all expenses
        if (clearAllExpenses) {
          clearAllExpenses.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete all expenses? This cannot be undone.')) {
              expenses = [];
              localStorage.setItem('expenseTrackerData', JSON.stringify(expenses));
              applyFilters();
            }
          });
        }
        
        // Export data
        if (exportExpenseData) {
          exportExpenseData.addEventListener('click', exportExpenses);
        }
        
        // Print report
        if (printExpenseReport) {
          printExpenseReport.addEventListener('click', function() {
            window.print();
          });
        }
        
        // Expense list event delegation for edit/delete buttons
        if (expenseList) {
          expenseList.addEventListener('click', function(e) {
            const target = e.target.closest('button');
            if (!target) return;
            
            const expenseItem = target.closest('.list-group-item');
            if (!expenseItem) return;
            
            const expenseId = expenseItem.dataset.id;
            
            if (target.classList.contains('edit-expense')) {
              editExpense(expenseId);
            } else if (target.classList.contains('delete-expense')) {
              deleteExpense(expenseId);
            }
          });
        }
      }
      
      // ----- Core Functions -----
      function handleAddExpense(e) {
        e.preventDefault();
        
        // Get form values
        const description = document.getElementById('expenseDescription').value.trim();
        const amountInput = document.getElementById('expenseAmount').value;
        const amount = parseFloat(amountInput);
        const category = document.getElementById('expenseCategory').value;
        const date = document.getElementById('expenseDate').value;
        const notes = document.getElementById('expenseNotes').value.trim();
        
        // Validate inputs
        if (!description) {
          alert("Please enter a description");
          return false;
        }
        
        if (!amountInput || isNaN(amount) || amount <= 0) {
          alert("Please enter a valid amount");
          return false;
        }
        
        if (!category) {
          alert("Please select a category");
          return false;
        }
        
        if (!date) {
          alert("Please select a date");
          return false;
        }
        
        if (isInEditMode && currentEditId) {
          // Update existing expense
          const index = expenses.findIndex(exp => exp.id === currentEditId);
          if (index !== -1) {
            expenses[index] = {
              ...expenses[index],
              description,
              amount,
              category, 
              date,
              notes
            };
            
            // Exit edit mode
            isInEditMode = false;
            currentEditId = null;
            
            // Update button text
            const submitBtn = addExpenseForm.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Add Expense';
            submitBtn.classList.remove('btn-warning');
          }
        } else {
          // Add new expense
          const newExpense = {
            id: Date.now().toString(36) + Math.random().toString(36).substring(2),
            description,
            amount,
            category,
            date,
            notes,
            timestamp: new Date().toISOString()
          };
          
          expenses.push(newExpense);
        }
        
        // Save to localStorage
        localStorage.setItem('expenseTrackerData', JSON.stringify(expenses));
        
        // Reset form
        addExpenseForm.reset();
        document.getElementById('expenseDate').valueAsDate = new Date();
        
        // Apply filters and update UI
        filterDateRange.value = 'all'; // Show all expenses including the new one
        applyFilters();
        
        return false;
      }
      
      function loadExpenses() {
        const savedExpenses = localStorage.getItem('expenseTrackerData');
        if (savedExpenses) {
          try {
            expenses = JSON.parse(savedExpenses);
            console.log(`Loaded ${expenses.length} expenses from localStorage`);
          } catch (error) {
            console.error('Error parsing saved expenses:', error);
            expenses = [];
          }
        } else {
          console.log("No saved expenses found");
          expenses = [];
        }
        
        applyFilters();
      }
      
      function applyFilters() {
        const dateRangeValue = filterDateRange ? filterDateRange.value : 'all';
        const categoryValue = document.getElementById('filterCategory') ? 
                              document.getElementById('filterCategory').value : 'all';
        const minAmount = document.getElementById('filterMinAmount') && document.getElementById('filterMinAmount').value ? 
                         parseFloat(document.getElementById('filterMinAmount').value) : 0;
        const maxAmount = document.getElementById('filterMaxAmount') && document.getElementById('filterMaxAmount').value ? 
                         parseFloat(document.getElementById('filterMaxAmount').value) : Infinity;
        
        // Calculate date range
        let startDate, endDate;
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        switch (dateRangeValue) {
          case 'today':
            startDate = today;
            endDate = new Date(today);
            endDate.setHours(23, 59, 59, 999);
            break;
          case 'week':
            startDate = new Date(today);
            startDate.setDate(today.getDate() - today.getDay());
            endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            endDate.setHours(23, 59, 59, 999);
            break;
          case 'month':
            startDate = new Date(today.getFullYear(), today.getMonth(), 1);
            endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            endDate.setHours(23, 59, 59, 999);
            break;
          case 'year':
            startDate = new Date(today.getFullYear(), 0, 1);
            endDate = new Date(today.getFullYear(), 11, 31);
            endDate.setHours(23, 59, 59, 999);
            break;
          case 'custom':
            startDate = document.getElementById('filterStartDate') && document.getElementById('filterStartDate').value ? 
                      new Date(document.getElementById('filterStartDate').value) : new Date(0);
            endDate = document.getElementById('filterEndDate') && document.getElementById('filterEndDate').value ? 
                    new Date(document.getElementById('filterEndDate').value) : new Date(8640000000000000);
            endDate.setHours(23, 59, 59, 999);
            break;
          default: // all
            startDate = new Date(0);
            endDate = new Date(8640000000000000);
        }
        
        // Apply all filters
        filteredExpenses = expenses.filter(expense => {
          try {
            const expenseDate = new Date(expense.date);
            const expenseAmount = expense.amount;
            
            // Date range filter
            const dateInRange = expenseDate >= startDate && expenseDate <= endDate;
            
            // Category filter
            const categoryMatch = categoryValue === 'all' || expense.category === categoryValue;
            
            // Amount range filter
            const amountInRange = expenseAmount >= minAmount && expenseAmount <= maxAmount;
            
            return dateInRange && categoryMatch && amountInRange;
          } catch (e) {
            console.error("Error filtering expense:", expense, e);
            return false;
          }
        });
        
        // Sort by date (newest first)
        filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Update UI
        updateUI();
      }
      
      function updateUI() {
        // Update expense count
        if (expenseCount) {
          expenseCount.textContent = `${filteredExpenses.length} expense${filteredExpenses.length !== 1 ? 's' : ''}`;
        }
        
        // Render expense list
        renderExpenseList();
        
        // Update summary
        updateSummary();
        
        // Update charts
        updateCharts();
      }
      
      function renderExpenseList() {
        if (!expenseList) return;
        
        if (filteredExpenses.length === 0) {
          expenseList.innerHTML = `
            <div class="text-center p-4 text-muted">
              <i class="ri-inbox-line d-block mb-3" style="font-size: 2rem;"></i>
              <p>No expenses to show for the selected filters.</p>
            </div>
          `;
          return;
        }
        
        // Clear the current list
        expenseList.innerHTML = '';
        
        // Add expense items
        filteredExpenses.forEach(expense => {
          // Create expense item element
          const expenseItem = document.createElement('div');
          expenseItem.className = 'list-group-item bg-dark text-light border-secondary';
          expenseItem.dataset.id = expense.id;
          
          const emoji = getCategoryEmoji(expense.category);
          const formattedDate = formatDate(expense.date);
          
          expenseItem.innerHTML = `
            <div class="d-flex w-100 justify-content-between align-items-center">
              <div>
                <h6 class="mb-1">${emoji} ${expense.description}</h6>
                <p class="mb-0 small text-muted">${formattedDate}</p>
              </div>
              <div class="text-end">
                <h5 class="mb-0 text-danger">${formatCurrency(expense.amount)}</h5>
              </div>
            </div>
            ${expense.notes ? `<p class="mb-1 small text-white-50 mt-2">${expense.notes}</p>` : ''}
            <div class="d-flex mt-2 justify-content-end gap-2">
              <button class="btn btn-outline-secondary btn-sm edit-expense">
                <i class="ri-edit-line me-1"></i>Edit
              </button>
              <button class="btn btn-outline-danger btn-sm delete-expense">
                <i class="ri-delete-bin-line me-1"></i>Delete
              </button>
            </div>
          `;
          
          expenseList.appendChild(expenseItem);
        });
      }
      
      function updateSummary() {
        const totalPeriodExpensesEl = document.getElementById('totalPeriodExpenses');
        const averageDailyExpensesEl = document.getElementById('averageDailyExpenses');
        
        if (!totalPeriodExpensesEl || !averageDailyExpensesEl) return;
        
        // Calculate total expenses
        const totalExpenses = filteredExpenses.reduce((total, expense) => total + expense.amount, 0);
        totalPeriodExpensesEl.textContent = formatCurrency(totalExpenses);
        
        // Calculate daily average
        if (filteredExpenses.length > 0) {
          // Get unique dates
          const uniqueDates = new Set(filteredExpenses.map(e => e.date.split('T')[0]));
          const uniqueDaysCount = uniqueDates.size;
          
          const dailyAverage = totalExpenses / Math.max(1, uniqueDaysCount);
          averageDailyExpensesEl.textContent = formatCurrency(dailyAverage);
        } else {
          averageDailyExpensesEl.textContent = formatCurrency(0);
        }
      }
      
      function initCharts() {
        // Check if chart elements exist
        if (!categoryChartCanvas || !trendChartCanvas) {
          console.log("Chart canvases not found");
          return;
        }
        
        // Check if Chart.js is available
        if (typeof Chart === 'undefined') {
          console.error("Chart.js library not found");
          return;
        }
        
        try {
          // Initialize category chart
          categoryChart = new Chart(categoryChartCanvas, {
            type: 'doughnut',
            data: {
              labels: [],
              datasets: [{
                data: [],
                backgroundColor: [
                  '#28a745', '#218838', '#1e7e34', '#5cb85c', '#75c378',
                  '#86d17b', '#1b5e20', '#a5d6a7', '#43a047', '#4caf50'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'right',
                  labels: {
                    color: '#e2e2e2',
                    font: {
                      size: 11
                    }
                  }
                }
              }
            }
          });
          
          // Initialize trend chart
          trendChart = new Chart(trendChartCanvas, {
            type: 'line',
            data: {
              labels: [],
              datasets: [{
                label: 'Daily Expenses',
                data: [],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    color: '#e2e2e2'
                  },
                  grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                  }
                },
                x: {
                  ticks: {
                    color: '#e2e2e2'
                  },
                  grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                  }
                }
              },
              plugins: {
                legend: {
                  display: false
                }
              }
            }
          });
          
          console.log("Charts initialized successfully");
        } catch (error) {
          console.error("Error initializing charts:", error);
        }
      }
      
      function updateCharts() {
        if (!categoryChart || !trendChart) {
          console.log("Charts not initialized");
          return;
        }
        
        try {
          // Update Category Chart
          const categories = {};
          filteredExpenses.forEach(expense => {
            categories[expense.category] = (categories[expense.category] || 0) + expense.amount;
          });
          
          const categoryLabels = [];
          const categoryData = [];
          
          Object.keys(categories).forEach(category => {
            const emoji = getCategoryEmoji(category);
            const name = category.charAt(0).toUpperCase() + category.slice(1);
            categoryLabels.push(`${emoji} ${name}`);
            categoryData.push(categories[category]);
          });
          
          categoryChart.data.labels = categoryLabels;
          categoryChart.data.datasets[0].data = categoryData;
          categoryChart.update();
          
          // Update Trend Chart - Group by date
          const dateGroups = {};
          filteredExpenses.forEach(expense => {
            const date = expense.date.split('T')[0];
            dateGroups[date] = (dateGroups[date] || 0) + expense.amount;
          });
          
          // Sort dates and prepare data
          const sortedDates = Object.keys(dateGroups).sort();
          const trendLabels = sortedDates.map(date => {
            const d = new Date(date);
            return `${d.getMonth() + 1}/${d.getDate()}`;
          });
          
          const trendData = sortedDates.map(date => dateGroups[date]);
          
          trendChart.data.labels = trendLabels;
          trendChart.data.datasets[0].data = trendData;
          trendChart.update();
        } catch (error) {
          console.error("Error updating charts:", error);
        }
      }
      
      function editExpense(id) {
        const expense = expenses.find(e => e.id === id);
        if (!expense) return;
        
        // Set form values
        document.getElementById('expenseDescription').value = expense.description;
        document.getElementById('expenseAmount').value = expense.amount;
        document.getElementById('expenseCategory').value = expense.category;
        document.getElementById('expenseDate').value = expense.date;
        document.getElementById('expenseNotes').value = expense.notes || '';
        
        // Set edit mode
        isInEditMode = true;
        currentEditId = id;
        
        // Update button text
        const submitBtn = addExpenseForm.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Update Expense';
        submitBtn.classList.add('btn-warning');
        
        // Scroll to form
        addExpenseForm.scrollIntoView({ behavior: 'smooth' });
      }
      
      function deleteExpense(id) {
        // Remove confirmation dialog as requested by user
        const index = expenses.findIndex(e => e.id === id);
        if (index !== -1) {
          expenses.splice(index, 1);
          localStorage.setItem('expenseTrackerData', JSON.stringify(expenses));
          applyFilters();
        }
      }
      
      function exportExpenses() {
        // Create CSV content
        const headers = ['Date', 'Description', 'Category', 'Amount', 'Notes'];
        const rows = [headers.join(',')];
        
        filteredExpenses.forEach(expense => {
          const row = [
            expense.date,
            `"${expense.description.replace(/"/g, '""')}"`, // Escape quotes
            `"${expense.category}"`,
            expense.amount,
            `"${expense.notes ? expense.notes.replace(/"/g, '""') : ''}"`
          ];
          rows.push(row.join(','));
        });
        
        const csvContent = rows.join('\n');
        
        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.setAttribute('href', url);
        link.setAttribute('download', 'expense_data.csv');
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
      
      // Start the expense tracker
      init();
    }
  </script>
  
</body>
</html>
